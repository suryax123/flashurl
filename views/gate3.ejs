<![CDATA[<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Final Step - Get Your Link! - FlashURL</title>
  <link rel="stylesheet" href="/css/style.css" />
  <script src="https://www.google.com/recaptcha/api.js" async defer></script>
</head>
<body>
  <div class="container">
    <main>
      <div class="card redirect-card" role="main" aria-labelledby="final-title">
        <div class="step-progress" aria-hidden="true">
          <div class="step completed">‚úì</div>
          <div class="step-line completed"></div>
          <div class="step completed">‚úì</div>
          <div class="step-line completed"></div>
          <div class="step active">3</div>
        </div>

        <h2 id="final-title">üéâ Your link is ready!</h2>
        <p class="step-text">One last step ‚Äî quick verification to prevent abuse.</p>

        <div class="ad-container">
          <div class="ad-box banner-ad" role="region" aria-label="Advertisement">
            <script>
              atOptions = {
                  'key' : '3eff8504b33c6f3f2949267088e6b4c3',
                  'format' : 'iframe',
                  'height' : 60,
                  'width' : 468,
                  'params' : {}
              };
            </script>
            <script src="https://www.highperformanceformat.com/3eff8504b33c6f3f2949267088e6b4c3/invoke.js"></script>
          </div>
        </div>

        <div class="countdown" id="countdownSection" aria-live="polite">
          <p>Please wait <span id="timer" class="timer-count" aria-atomic="true">5</span> seconds</p>
          <div class="progress-bar"><div class="progress" id="progress"></div></div>
        </div>

        <div id="captchaSection" class="captcha-section hidden" aria-hidden="true">
          <p>Verify you're human to get your link:</p>
          <div class="recaptcha-container">
            <div class="g-recaptcha"
                 data-sitekey="<%= siteKey %>"
                 data-callback="onCaptchaSuccess"
                 data-size="normal">
            </div>
          </div>
          <p class="captcha-note">Click the checkbox to continue</p>
          <p id="captchaError" class="error-text hidden" role="alert"></p>
        </div>

        <div id="getLinkSection" class="get-link-section hidden" aria-hidden="true">
          <p class="success-text">‚úÖ Verified! Click below to continue</p>
          <a href="#" id="getLinkBtn" class="btn btn-success">üîó GET LINK</a>
        </div>

        <div class="destination" aria-hidden="false">
          <p>Destination:</p>
          <code><%= originalUrl %></code>
        </div>

        <div class="ad-container">
          <div class="ad-box banner-ad" role="region" aria-label="Advertisement">
            <script>
              atOptions = {
                  'key' : '3eff8504b33c6f3f2949267088e6b4c3',
                  'format' : 'iframe',
                  'height' : 60,
                  'width' : 468,
                  'params' : {}
              };
            </script>
            <script src="https://www.highperformanceformat.com/3eff8504b33c6f3f2949267088e6b4c3/invoke.js"></script>
          </div>
        </div>
      </div>
    </main>

    <footer>
      <p>¬© 2025 FlashURL. Made with ‚ù§Ô∏è</p>
    </footer>
  </div>

  <script>
    (function() {
      var timeLeft = 5;
      var timerEl = document.getElementById('timer');
      var progressEl = document.getElementById('progress');
      var countdownSection = document.getElementById('countdownSection');
      var captchaSection = document.getElementById('captchaSection');
      var getLinkSection = document.getElementById('getLinkSection');
      var captchaError = document.getElementById('captchaError');
      var getLinkBtn = document.getElementById('getLinkBtn');
      var shortId = '<%= shortId %>';
      var verifiedUrl = null;

      function updateProgress() {
        var elapsed = 5 - timeLeft;
        progressEl.style.width = ((elapsed) / 5 * 100) + '%';
      }

      var countdown = setInterval(function() {
        timeLeft = timeLeft - 1;
        if (timerEl) timerEl.textContent = timeLeft;
        updateProgress();

        if (timeLeft <= 0) {
          clearInterval(countdown);
          if (countdownSection) countdownSection.style.display = 'none';
          if (captchaSection) {
            captchaSection.classList.remove('hidden');
            captchaSection.setAttribute('aria-hidden', 'false');
            captchaSection.style.display = 'block';
          }
        }
      }, 1000);

      window.onCaptchaSuccess = function(token) {
        // Verify CAPTCHA on server
        fetch('/verify/' + shortId, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ captchaToken: token })
        })
        .then(function(response){ return response.json(); })
        .then(function(data) {
          if (data.success) {
            verifiedUrl = data.redirectUrl;
            if (captchaSection) captchaSection.style.display = 'none';
            if (getLinkSection) {
              getLinkSection.classList.remove('hidden');
              getLinkSection.setAttribute('aria-hidden', 'false');
              getLinkSection.style.display = 'block';
            }
          } else {
            if (captchaError) {
              captchaError.textContent = data.error || 'Verification failed. Please try again.';
              captchaError.classList.remove('hidden');
            }
            if (typeof grecaptcha !== 'undefined') grecaptcha.reset();
          }
        })
        .catch(function() {
          if (captchaError) {
            captchaError.textContent = 'Network error. Please try again.';
            captchaError.classList.remove('hidden');
          }
          if (typeof grecaptcha !== 'undefined') grecaptcha.reset();
        });
      };

      if (getLinkBtn) {
        getLinkBtn.addEventListener('click', function(e) {
          e.preventDefault();
          if (verifiedUrl) window.location.href = verifiedUrl;
        });
      }
    })();
  </script>

  <script src="/js/adblock-detect.js"></script>
  <script src="https://pl28355881.effectivegatecpm.com/41/b9/68/41b9683409b2e1df660f482f0a40d231.js"></script>
</body>
</html>]]>
